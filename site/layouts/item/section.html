{{ define "main" }}
  <div><a href="{{ .RelPermalink }}">MAIN</a></div>

  {{ $paginator := .Paginate (where .Pages "Type" "item") }}


  <div class="grid grid-cols-4 gap-4">
    {{ range $paginator.Pages }}
      <div>
        <a href="{{ .RelPermalink }}" title="{{ .Title }}">
          {{/* <img
            src="{{ .Params.img
          }}"
          alt="" title="Portrait of {{ .Title }}" /> */}}
          <strong>{{ .Title }}</strong>
          <p>Last spotted in {{ .Params.spotted }}</p>
        </a>
      </div>
    {{ end }}
  </div>

  {{ template "_internal/pagination.html" . }}

  {{ block "pagination" . }}{{ end }}
{{ end }}

{{ define "pagination" }}
  {{ $paginator := .Paginator }}


  <!-- Number of links either side of the current page. -->
  {{ $adjacent_links := 2 }}
  <!-- $max_links = ($adjacent_links * 2) + 1 -->
  {{ $max_links := (add (mul $adjacent_links 2) 1) }}
  <!-- $lower_limit = $adjacent_links + 1 -->
  {{ $lower_limit := (add $adjacent_links 1) }}
  <!-- $upper_limit = $paginator.TotalPages - $adjacent_links -->
  {{ $upper_limit := (sub $paginator.TotalPages $adjacent_links) }}

  {{ if gt $paginator.TotalPages 1 }}

    <ul class="pagination">
      {{ if ne $paginator.PageNumber 1 }}
        <li>
          <a class="pagination__item first" href="{{ $paginator.First.URL }}">
            ««
          </a>
        </li>
      {{ end }}

      {{ if $paginator.HasPrev }}
        <li>
          <a href="{{ $paginator.Prev.URL }}" class="pagination__item prev">
            <-
          </a>
        </li>
      {{ end }}

      {{ range $paginator.Pagers }}
        {{ $.Scratch.Set "page_number_flag" false }}

        {{ if gt $paginator.TotalPages $max_links }}

          {{ if le $paginator.PageNumber $lower_limit }}

            <!-- Logic to show only necessary lower limit pages. -->
            {{ if le .PageNumber $max_links }}
              {{ $.Scratch.Set "page_number_flag" true }}
            {{ end }}
            <!-- Upper limit pages. -->
            <!-- If the user is on a page which is in the upper limit. -->
          {{ else if ge $paginator.PageNumber $upper_limit }}
            <!-- Logic to show only necessary upper limit pages. -->
            {{ if gt .PageNumber (sub $paginator.TotalPages $max_links) }}
              {{ $.Scratch.Set "page_number_flag" true }}
            {{ end }}
            <!-- Middle pages. -->
          {{ else }}
            <!-- Logic to show only necessary middle pages. -->
            {{ if and ( ge .PageNumber (sub $paginator.PageNumber $adjacent_links) ) ( le .PageNumber (add $paginator.PageNumber $adjacent_links) ) }}
              {{ $.Scratch.Set "page_number_flag" true }}
            {{ end }}
          {{ end }}

        {{ else }}
          {{ $.Scratch.Set "page_number_flag" true }}
        {{ end }}

        {{ if eq ($.Scratch.Get "page_number_flag") true }}
          <li>
            <a
              class="pagination__item {{ if eq . $paginator }}current{{ end }}"
              href="{{ .URL }}"
            >
              {{ .PageNumber }}
            </a>
          </li>
        {{ end }}

      {{ end }}

      {{ if $paginator.HasNext }}
        <li>
          <a href="{{ $paginator.Next.URL }}" class="pagination__item next">
            ->
          </a>
        </li>
      {{ end }}

      {{ if ne $paginator.PageNumber $paginator.TotalPages }}
        <li>
          <a class="pagination__item last" href="{{ $paginator.Last.URL }}">
            »»
          </a>
        </li>
      {{ end }}

    </ul>
  {{ end }}
{{ end }}
